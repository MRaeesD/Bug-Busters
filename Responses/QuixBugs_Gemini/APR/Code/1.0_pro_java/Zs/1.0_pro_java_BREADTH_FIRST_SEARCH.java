// Changed 'while (true)' to 'while (!queue.isEmpty())' to terminate the loop when the queue is empty.
while (!queue.isEmpty()) {
    Node node = queue.removeFirst();
